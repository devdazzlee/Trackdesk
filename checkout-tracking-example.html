<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Checkout Tracking Example</title>
    
    <!-- Trackdesk CDN Script -->
    <script src="http://localhost:3001/trackdesk-fixed.js" 
            data-website-id="web_demo123" 
            data-auto-init="true">
    </script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .product {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .cart {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .checkout {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>E-commerce Tracking Demo</h1>
    
    <!-- Product Page -->
    <div id="product-page">
        <h2>Products</h2>
        
        <div class="product" data-product-id="PROD-001" data-product-name="Premium Plan" data-price="99.99">
            <h3>Premium Plan - $99.99</h3>
            <p>Advanced features and priority support</p>
            <button class="button" onclick="viewProduct('PROD-001', 'Premium Plan', 99.99)">View Details</button>
            <button class="button" onclick="addToCart('PROD-001', 'Premium Plan', 99.99)">Add to Cart</button>
        </div>
        
        <div class="product" data-product-id="PROD-002" data-product-name="Basic Plan" data-price="29.99">
            <h3>Basic Plan - $29.99</h3>
            <p>Essential features for getting started</p>
            <button class="button" onclick="viewProduct('PROD-002', 'Basic Plan', 29.99)">View Details</button>
            <button class="button" onclick="addToCart('PROD-002', 'Basic Plan', 29.99)">Add to Cart</button>
        </div>
    </div>
    
    <!-- Cart -->
    <div id="cart-section" class="cart" style="display: none;">
        <h2>Shopping Cart</h2>
        <div id="cart-items"></div>
        <p>Total: $<span id="cart-total">0.00</span></p>
        <button class="button" onclick="startCheckout()">Proceed to Checkout</button>
    </div>
    
    <!-- Checkout Form -->
    <div id="checkout-section" class="checkout" style="display: none;">
        <h2>Checkout</h2>
        <form id="checkout-form">
            <div>
                <label>Email:</label>
                <input type="email" id="customer-email" required>
            </div>
            <div>
                <label>Name:</label>
                <input type="text" id="customer-name" required>
            </div>
            <div>
                <label>Payment Method:</label>
                <select id="payment-method" required>
                    <option value="credit_card">Credit Card</option>
                    <option value="paypal">PayPal</option>
                    <option value="stripe">Stripe</option>
                </select>
            </div>
            <button type="submit" class="button">Complete Purchase</button>
        </form>
    </div>
    
    <!-- Success Page -->
    <div id="success-section" class="success" style="display: none;">
        <h2>Purchase Successful!</h2>
        <p>Thank you for your purchase. Order ID: <span id="order-id"></span></p>
        <p>Total: $<span id="purchase-total"></span></p>
    </div>
    
    <!-- Debug Info -->
    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
        <h3>Debug Information</h3>
        <p>Session ID: <span id="debug-session"></span></p>
        <p>Website ID: <span id="debug-website"></span></p>
        <p>User ID: <span id="debug-user"></span></p>
        <p>Events in Queue: <span id="debug-events"></span></p>
        <button class="button" onclick="showDebugInfo()">Refresh Debug Info</button>
        <button class="button" onclick="flushEvents()">Flush Events</button>
    </div>

    <script>
        // Cart state
        let cart = [];
        let currentStep = 'product';
        
        // Initialize tracking when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Track page view
            Trackdesk.track('page_view', {
                page: 'product_catalog',
                category: 'ecommerce'
            });
            
            updateDebugInfo();
        });
        
        // Product tracking functions
        function viewProduct(productId, productName, price) {
            Trackdesk.track('product_view', {
                productId: productId,
                productName: productName,
                category: 'software',
                price: price,
                currency: 'USD'
            });
            
            alert(`Viewing ${productName} - $${price}`);
        }
        
        function addToCart(productId, productName, price) {
            // Add to cart
            cart.push({
                id: productId,
                name: productName,
                price: price,
                quantity: 1
            });
            
            // Track add to cart
            Trackdesk.track('add_to_cart', {
                productId: productId,
                productName: productName,
                price: price,
                currency: 'USD',
                quantity: 1,
                cartValue: getCartTotal()
            });
            
            // Show cart
            showCart();
            updateDebugInfo();
        }
        
        function showCart() {
            document.getElementById('cart-section').style.display = 'block';
            updateCartDisplay();
        }
        
        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            cartItems.innerHTML = '';
            cart.forEach(item => {
                const div = document.createElement('div');
                div.innerHTML = `${item.name} - $${item.price} x ${item.quantity}`;
                cartItems.appendChild(div);
            });
            
            cartTotal.textContent = getCartTotal().toFixed(2);
        }
        
        function getCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }
        
        function startCheckout() {
            // Track checkout start
            Trackdesk.track('checkout_start', {
                value: getCartTotal(),
                currency: 'USD',
                items: cart,
                step: 'checkout_form'
            });
            
            // Show checkout form
            document.getElementById('checkout-section').style.display = 'block';
            currentStep = 'checkout';
            updateDebugInfo();
        }
        
        // Checkout form submission
        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('customer-email').value;
            const name = document.getElementById('customer-name').value;
            const paymentMethod = document.getElementById('payment-method').value;
            
            // Generate order ID
            const orderId = 'ORD-' + Date.now();
            
            // Identify user
            Trackdesk.identify('user_' + email.replace('@', '_'), {
                email: email,
                name: name
            });
            
            // Track purchase
            Trackdesk.track('purchase', {
                orderId: orderId,
                value: getCartTotal(),
                currency: 'USD',
                paymentMethod: paymentMethod,
                items: cart,
                customer: {
                    email: email,
                    name: name
                },
                shipping: {
                    method: 'standard',
                    cost: 0
                },
                tax: 0
            });
            
            // Track conversion
            Trackdesk.convert({
                type: 'purchase',
                value: getCartTotal(),
                currency: 'USD',
                orderId: orderId
            });
            
            // Show success page
            showSuccessPage(orderId, getCartTotal());
            updateDebugInfo();
        });
        
        function showSuccessPage(orderId, total) {
            document.getElementById('success-section').style.display = 'block';
            document.getElementById('order-id').textContent = orderId;
            document.getElementById('purchase-total').textContent = total.toFixed(2);
            
            // Track purchase success
            Trackdesk.track('purchase_success', {
                orderId: orderId,
                value: total,
                currency: 'USD',
                step: 'confirmation'
            });
        }
        
        // Debug functions
        function updateDebugInfo() {
            document.getElementById('debug-session').textContent = Trackdesk.getSessionId() || 'Not set';
            document.getElementById('debug-website').textContent = Trackdesk.getWebsiteId() || 'Not set';
            document.getElementById('debug-user').textContent = Trackdesk.getUserId() || 'Not set';
            document.getElementById('debug-events').textContent = Trackdesk.getEventQueue().length;
        }
        
        function showDebugInfo() {
            updateDebugInfo();
            console.log('Trackdesk Debug Info:', {
                sessionId: Trackdesk.getSessionId(),
                websiteId: Trackdesk.getWebsiteId(),
                userId: Trackdesk.getUserId(),
                eventQueue: Trackdesk.getEventQueue(),
                config: Trackdesk.config
            });
        }
        
        function flushEvents() {
            Trackdesk.flush();
            updateDebugInfo();
        }
        
        // Track page interactions
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                Trackdesk.track('button_click', {
                    buttonText: e.target.textContent,
                    buttonClass: e.target.className,
                    page: currentStep
                });
            }
        });
        
        // Track form interactions
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                Trackdesk.track('form_interaction', {
                    fieldName: e.target.id,
                    fieldType: e.target.type,
                    page: currentStep
                });
            }
        });
    </script>
</body>
</html>
